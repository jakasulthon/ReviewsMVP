<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="./css/pico.css" type="text/css" />
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.13.0/css/all.css">
    <script type="text/javascript" src="./review.js"></script>
    <script type="text/javascript" src="./data.js"></script>
    <script type="text/javascript" src="./app.js"></script>
    <title></title>
  </head>
  <body>
    <main class="container">
      <div>

      </div>
      <article id="article-placeholder">
        <div class="static-products" hidden>
          <h1>The Minimalist Entrepreneur</h1>
          <ul>
            <span class="num">
              0
            </span>
            <i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="1"></i>
            <i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="2"></i>
            <i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="3"></i>
            <i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="4"></i>
            <i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="5"></i>
            <a href="#add" role="button" class="outline">Add review</a>
          </ul>
          <hr />
        </div>

        <div id="dynamic-products" hidden>

        </div>
        <div id="dynamic2-products">

        </div>
        <h4>Review</h4>
        <div class="static-reviews" hidden>
          <ul class="ulreview">
            <span class="num">
              0
            </span>
            <i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="1"></i>
            <i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="2"></i>
            <i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="3"></i>
            <i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="4"></i>
            <i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="5"></i>
            <span>The best of the best!</span>
            <span class="edit" style="display: none"><i class="fas fa-pen"></i></span>
            <span class="delete" style="display: none"><i class="fas fa-times"></i></span>
          </ul>
          <ul class="ulreview">
            <span class="num">
              0
            </span>
            <i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="1"></i>
            <i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="2"></i>
            <i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="3"></i>
            <i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="4"></i>
            <i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="5"></i>
            <span>The best of the best!</span>
            <span class="edit" style="display: none"><i class="fas fa-pen"></i></span>
            <span class="delete" style="display: none"><i class="fas fa-times"></i></span>
          </ul>
          <ul class="ulreview">
            <span class="num">
              0
            </span>
            <i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="1"></i>
            <i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="2"></i>
            <i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="3"></i>
            <i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="4"></i>
            <i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="5"></i>
            <span>The best of the best!</span>
            <span class="edit" style="display: none"><i class="fas fa-pen"></i></span>
            <span class="delete" style="display: none"><i class="fas fa-times"></i></span>
          </ul>
          <ul class="ulreview">
            <span class="num">
              0
            </span>
            <i class="far fa-star rv-stars" style="color: #FFCC33; cursor: pointer" data-num="1"></i>
            <i class="far fa-star rv-stars" style="color: #FFCC33; cursor: pointer" data-num="2"></i>
            <i class="far fa-star rv-stars" style="color: #FFCC33; cursor: pointer" data-num="3"></i>
            <i class="far fa-star rv-stars" style="color: #FFCC33; cursor: pointer" data-num="4"></i>
            <i class="far fa-star rv-stars" style="color: #FFCC33; cursor: pointer" data-num="5"></i>
            <span class="description">The best of the best!</span>
            <span class="edit" style="display: none"><a href=""><i class="fas fa-pen"></i></a></span>
            <span class="delete" style="display: none"><i class="fas fa-times"></i></span>
          </ul>
        </div>
        <div id="dynamic-reviews" hidden>

        </div>
        <div id="dynamic2-reviews"hidden>

        </div>
        <div id="dynamic3-reviews" hidden>

        </div>
        <div id="dynamic4-reviews">

        </div>
        <hr />
        <h1 id="add">Whats Your Rating?</h1>
        <p>
          Rating
        </p>
        <ul>
          <span class="new-num">
            0
          </span>
          <i class="far fa-star new-review" style="color: #FFCC33; cursor: pointer" data-num="1"></i>
          <i class="far fa-star new-review" style="color: #FFCC33; cursor: pointer" data-num="2"></i>
          <i class="far fa-star new-review" style="color: #FFCC33; cursor: pointer" data-num="3"></i>
          <i class="far fa-star new-review" style="color: #FFCC33; cursor: pointer" data-num="4"></i>
          <i class="far fa-star new-review" style="color: #FFCC33; cursor: pointer" data-num="5"></i>
          <span class="new-alert" style="color: red" hidden>
            Please fill the rating
          </span>
        </ul>
        <p>
          Review
        </p>
        <span class="new-alert" style="color: red" hidden>
          Please fill the description
        </span>
        <input class="new-description" placeholder="" />
        <button class="warning new-submit">Submit Review</button>
      </article>
    </main>
  </body>
  <script>


/** For getting product id & redirect if product id is null */

const queryString = window.location.search;
const urlParams = new URLSearchParams(queryString);
const product_id = parseInt(urlParams.get('id'));

console.log(product_id);

if (urlParams.get('id') == null) {
  window.location.href = "./products.sandbox.html";
  console.log(product_id + ' is NaN');
};


/** For listing reviews */

  // v1 review
  // const rv_placeholders = document.getElementById('dynamic-reviews');
  // REVIEW_DATA[0].reviews.map(data => {
  //   rv_placeholders.innerHTML +=
  //     '<ul class="ulreview">'
  //        + '<i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="1"></i>'
  //        + '<i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="2"></i>'
  //        + '<i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="3"></i>'
  //        + '<i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="4"></i>'
  //        + '<i class="far fa-star" style="color: #FFCC33; cursor: pointer" data-num="5"></i>'
  //        + '<span> ' + data.rating + '</span> '
  //        + '<span style="color: gray;">' + data.description + '</span> '
  //        + '<span class="edit" style="display: none"><i class="fas fa-pen"></i></span>'
  //        + '<span class="delete" style="display: none"><i class="fas fa-times"></i></span>'
  //      + '</ul>';
  //
  // });
  // console.log(REVIEW_DATA.length);

  // v2 - review
  // const rv2_placeholders = document.getElementById('dynamic2-reviews');
  // var HTML= "";
  // REVIEW_DATA[0].reviews.forEach((ob) => {
  //     HTML += '<ul class="ulreview">';
  //     for (var i=0; i < 5; i++) {
  //       var icoClass = i < ob.rating ? 'fas fa-star' : 'far fa-star';
  //       HTML += '<i class="' + icoClass + '" style="color: #FFCC33;"></i>';
  //     };
  //     HTML += '<span>' + ob.rating + '</span> ';
  //     HTML += '<span style="color: gray">' + ob.description + '</span> ';
  //     HTML += '<span class="edit" style="display: none"><i class="fas fa-pen"></i></span> ';
  //     HTML += '<span class="delete" style="display: none"><i class="fas fa-times"></i></span> ';
  //     HTML += '</ul>';
  // });
  // rv2_placeholders.innerHTML = HTML;

  // v1 - products

  // const pd_placeholders = document.getElementById('dynamic-products');
  //
  //
  // const RETRIEVED_DATA1 = listReview();
  //
  // let pd_HTML = "";
  //
  // RETRIEVED_DATA1.then(res => res.json()).then(data => {
  //   console.log(data);
  //   pd_HTML += '<h1>'+ data[0].data.product +'</h1>';
  //   pd_HTML += '<ul class="ulreview">';
  //   pd_HTML += '<span>'+ data[0].data.rating +'</span>';
  //   for (var i=0; i < 5; i++) {
  //     var icoClass = i < data[0].data.rating ? 'fas fa-star' : 'far fa-star';
  //     pd_HTML += '<i class="' + icoClass + '" style="color: #FFCC33;"></i>';
  //   };
  //   pd_HTML += '<a href="#add" role="button" class="outline">Add review</a>'
  //   pd_HTML += '</ul>';
  //
  //   // console.log(pd_HTML);
  //   pd_placeholders.innerHTML = pd_HTML;
  // });

  // v2 - products

  const pd2_placeholders = document.getElementById('dynamic2-products');



  const RETRIEVED_DATA2 = listAllReviews(product_id);

  let pd2_HTML = "";

  RETRIEVED_DATA2.then(res => res.json()).then(data => {
    console.log(data);
    pd2_HTML += '<h1>'+ data[0].product +'</h1>';
    pd2_HTML += '<ul class="ulreview">';
    pd2_HTML += '<span>'+ data[0].rating +'</span>';
    for (var i=0; i < 5; i++) {
      var icoClass = i < data[0].rating ? 'fas fa-star' : 'far fa-star';
      pd2_HTML += '<i class="' + icoClass + '" style="color: #FFCC33;"></i>';
    };
    pd2_HTML += '<a href="#add" role="button" class="outline">Add review</a>'
    pd2_HTML += '</ul>';

    document.title = data[0].product;

    // console.log(pd_HTML);
    pd2_placeholders.innerHTML = pd2_HTML;
  });

  // v3 - reviews

  // const RETRIEVED_DATA = listReview();
  //
  // const rv3_placeholders = document.getElementById('dynamic3-reviews');
  //
  // let rv3_HTML = "";
  //
  // RETRIEVED_DATA.then(res => res.json()).then(data => {
  //   console.log(data);
  //   data[0].data.reviews.forEach((item) => {
  //     rv3_HTML += '<ul class="ulreview">';
  //     for (var i=0; i < 5; i++) {
  //       var icoClass = i < item.rating ? 'fas fa-star' : 'far fa-star';
  //       rv3_HTML += '<i class="' + icoClass + '" style="color: #FFCC33;"></i>';
  //     };
  //     rv3_HTML += '<span>' + item.rating + '</span> ';
  //     rv3_HTML += '<span style="color: gray">' + item.description + '</span> ';
  //     rv3_HTML += '<span class="edit" style="display: none"><i class="fas fa-pen"></i></span> ';
  //     rv3_HTML += '<span class="delete" style="display: none"><i class="fas fa-times"></i></span> ';
  //     rv3_HTML += '</ul>';
  //   });
  //
  //   // console.log(rv3_HTML);
  //   rv3_placeholders.innerHTML = rv3_HTML;
  // });

  // v4 - reviews

  const RETRIEVED_DATA3 = listAllReviews(product_id);

  const rv4_placeholders = document.getElementById('dynamic4-reviews');

  let rv4_HTML = "";

  RETRIEVED_DATA3.then(res => res.json()).then(data => {
    console.log(data);
    data[0].reviews.forEach((item) => {
      rv4_HTML += '<ul class="ulreview">';
      for (var i=0; i < 5; i++) {
        var icoClass = i < item.rating ? 'fas fa-star' : 'far fa-star';
        rv4_HTML += '<i class="' + icoClass + '" style="color: #FFCC33;"></i>';
      };
      rv4_HTML += '<span>' + item.rating + '</span> ';
      rv4_HTML += '<span style="color: gray">' + item.description + '</span> ';
      rv4_HTML += '<span class="edit" style="display: none"><i class="fas fa-pen"></i></span> ';
      rv4_HTML += '<span class="delete" style="display: none"><i class="fas fa-times"></i></span> ';
      rv4_HTML += '</ul>';
    });

    // console.log(rv3_HTML);
    rv4_placeholders.innerHTML = rv4_HTML;
  });




/** For hovering edit & delete icon  */
  const ulreview = document.querySelectorAll('.ulreview');
  ulreview.forEach(review => {
    review.onmouseover = () => {
      review.children[7].setAttribute('style', 'display: inline');
        review.children[8].setAttribute('style', 'display: inline');
      // console.log('hovered');
      // console.log(review.children[7].getAttribute('style'));
    }
    review.onmouseout = () => {
      review.children[7].setAttribute('style', 'display: none');
        review.children[8].setAttribute('style', 'display: none');
      // console.log('hovered');
      // console.log(review.children[7].getAttribute('style'));
    }
  })

/** For hovering rating icon  */

  let rating = 0;
  const allstars = document.querySelectorAll('.fa-star');
  allstars.forEach(star => {
    star.onclick = () => {
      let starLevel = star.getAttribute('data-num');
      allstars.forEach(el => {
        if(starLevel < el.getAttribute('data-num')) {
          el.classList.remove('fas');
          el.classList.add('far');
        } else {
          el.classList.remove('far');
          el.classList.add('fas');
        }
      });
      console.log(starLevel);
      rating = starLevel;

      const responses = listReviews(rating);

      responses.then(res => res.json()).then(data => {
        document.querySelectorAll('.description')[0].innerHTML = data.title;
      })
    }
  });



  /** For submitting reviews */

  let reviews = {
      review_id : create_UUID(),
      rating : null,
      description : null
  }


  const newalert = document.querySelectorAll('.new-alert');

  const bintang = document.querySelectorAll('.new-review');
  bintang.forEach(star => {
    star.onclick = () => {
      let starLevel = star.getAttribute('data-num');
      console.log(starLevel);
      reviews.rating = parseInt(starLevel);
      console.log("Review's rating : " + reviews.rating);
      bintang.forEach(el => {
        if(starLevel < el.getAttribute('data-num')) {
          el.classList.remove('fas');
          el.classList.add('far');
        } else {
          el.classList.remove('far');
          el.classList.add('fas');
        }
      });
      console.log(reviews);
      document.getElementsByClassName('new-num')[0].innerHTML = starLevel;
      newalert[0].setAttribute("hidden", "");
    }
  });

  const deskripsi = document.querySelectorAll('.new-description');
  deskripsi[0].onkeyup = () => {
    reviews.description = deskripsi[0].value;
    console.log(deskripsi[0].value);
    console.log(reviews);
  }

  const submit = document.querySelectorAll('.new-submit');
  submit[0].onclick = () => {
    if (reviews.rating === null) {
      console.log(newalert[0].innerHTML);
      return newalert[0].removeAttribute("hidden");

    } else if (reviews.description === null || reviews.description === '') {
      console.log(newalert[1].innerHTML);
      return newalert[1].removeAttribute("hidden");

    } else if (reviews.description.length >= 0) {
      newalert[1].setAttribute("hidden", "");

      const hasil = saveReview(reviews);


      hasil.then(res => {
        const status = res.status;

        console.log(status);
        if (res.status === 200) {
          window.alert("you have submitted the reviews!")
          location.reload();
        }
      });
      // const hasil = "clicked";
      console.log(hasil);
    }


  }

  </script>
</html>
